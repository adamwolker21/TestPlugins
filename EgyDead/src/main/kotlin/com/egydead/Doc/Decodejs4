var uas = [];
var links = {
    "hls4": "/stream/ikbp00sGus7AzcvciXPoEA/kjhhiuahiuhgihdf/1760169272/59722936/master.m3u8",
    "hls2": "https://qpljyz39awcoenfd.premilkyway.com/hls2/01/11944/1woe41gjgjoq_,l,n,h,.urlset/master.m3u8?t=MTcPYmqhUCb-L8TWCtKr0c-mMyi7_u-HZKp62OWl0OE&s=1760126072&e=129600&f=59722936&srv=g3qezmygwi76p&i=0.4&sp=500&p1=g3qezmygwi76p&p2=g3qezmygwi76p&asn=36947",
    "hls3": "https://qpljyz39awcoenfd.zonesynapticwebscale.store/g3qezmygwi76p/hls3/01/11944/1woe41gjgjoq_,l,n,h,.urlset/master.txt"
};
jwplayer("vplayer").setup({
    debug: "1",
    sources: [{
        file: links.hls4 || links.hls3 || links.hls2,
        type: "hls"
    }],
    image: "https://pixoraa.cc/1woe41gjgjoq_xt.jpg",
    width: "100%",
    height: "100%",
    stretching: "uniform",
    duration: "6786.94",
    preload: 'auto',
    skin: {
        controlbar: {
            text: "#e22d2d",
            icons: "#e22d2d"
        },
        timeslider: {
            progress: "#e22d2d"
        },
        menus: {
            text: "#e22d2d"
        }
    },
    androidhls: "true",
    tracks: [{
        file: "/dl?op=get_slides&length=6787&url=https://pixoraa.cc/1woe41gjgjoq0000.jpg",
        kind: "thumbnails"
    }],
    captions: {
        userFontScale: 1,
        color: '#FFFFFF',
        backgroundColor: '#FFFFFF',
        fontFamily: "Tahoma",
        backgroundOpacity: 0,
        fontOpacity: '100',
    },
    "advertising": {
        "client": "vast",
        "vpaidmode": "insecure"
    },
    'qualityLabels': {
        "1992": "1080p",
        "1066": "720p",
        "507": "480p"
    },
    abouttext: "StreamHG",
    aboutlink: "https://streamhg.com",
    logo: {
        file: "/upload-data/logo_15.jpg",
        link: "https://egydead.live",
        position: "top-left",
        margin: "5",
        hide: true
    },
    cast: {},
    playbackRateControls: true,
    playbackRates: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2]
});
var vvplay, vvad;
var vastdone1 = 0,
    vastdone2 = 0,
    pop3done = 0;
var player = jwplayer();
var prevt = 0,
    tott = 0,
    v2done = 0,
    lastt = 0;
$.ajaxSetup({
    headers: {
        'Content-Cache': 'no-cache'
    }
});
player.on('time', function(x) {
    if (5 > 0 && x.position >= 5 && vvad != 1) {
        vvad = 1;
        $('div.video_ad_fadein').fadeIn('slow')
    }
    var itads = 0;
    uas.forEach(item => {
        if (item.time <= x.position && item.loaded == 0) {
            if (item.xtype == 'vast') {
                if (item.link.startsWith('https://')) {
                    player.playAd(item.link)
                } else {
                    var doc = new DOMParser().parseFromString(item.link, "text/html");
                    item.link = "data:application/xml;base64," + btoa(unescape(encodeURIComponent(doc.documentElement.textContent)));
                    player.playAd(item.link)
                }
            } else if (item.xtype == 'direct') {
                pickDirect(itads, item.link)
            } else {
                var code = item.link.trim();
                var script = document.createElement('script');
                if (code.startsWith('https://')) {
                    script.src = code;
                    script.async = true
                } else {
                    var doc = new DOMParser().parseFromString(code, "text/html");
                    code = doc.documentElement.textContent;
                    var match = code.match(/<script[^>]*>([\s\S]*?)<\/script>/i);
                    if (match) {
                        script.textContent = match[1]
                    } else {
                        script.textContent = code
                    }
                }
                document.body.appendChild(script)
            }
            item.loaded = 1
        }
        itads++
    });
    if (x.position >= lastt + 5 || x.position < lastt) {
        lastt = x.position;
        ls.set('tt1woe41gjgjoq', Math.round(lastt), {
            ttl: 60 * 60 * 24 * 7
        })
    }
    if (x.viewable) {
        dt = x.position - prevt;
        if (dt > 5) dt = 1;
        tott += dt
    }
    prevt = x.position;
    console.log(tott);
    if (tott >= 60) {
        $.post('https://logs.vectorrab.com/dl', {
            op: 'view4',
            hash: '59722936-105-105-1760126071-262bcd4712cf7209abe85a7c6147babb',
            ss: parseInt(tott),
            file_id: 59722936,
            file_real: '1woe41gjgjoq'
        }, function() {}, "jsonp");
        tott = 0
    }
});
player.on('seek', function(x) {
    prevt = x.position
});
player.on('play', function(x) {
    doPlay(x)
});
player.on('complete', function() {
    $('div.video_ad').show();
    ls.remove('tt1woe41gjgjoq')
});
player.on('pause', function(x) {});

function createCookieSec(name, value, sec) {
    var date = new Date();
    date.setTime(date.getTime() + (sec * 1000));
    document.cookie = name + "=" + value + "; expires=" + date.toGMTString() + "; domain=.kravaxxa.com; path=/; SameSite=None; Secure"
}

function doPlay(x) {
    $('div.video_ad').hide();
    $('#over_player_msg').hide();
    if (vvplay) return;
    vvplay = 1;
    adb = 0;
    const ggima = document.createElement('script');
    ggima.src = 'https://imasdk.googleapis.com/js/sdkloader/ima3.js';
    ggima.onerror = () => {
        $.get('/dl?op=view&file_code=1woe41gjgjoq&hash=59722936-105-105-1760126071-262bcd4712cf7209abe85a7c6147babb&embed=1&referer=&adb=1&hls4=1', function(data) {
            $('#fviews').html(data)
        })
    };
    ggima.onload = () => {
        $.get('/dl?op=view&file_code=1woe41gjgjoq&hash=59722936-105-105-1760126071-262bcd4712cf7209abe85a7c6147babb&embed=1&referer=&adb=0&hls4=1', function(data) {
            $('#fviews').html(data)
        })
    };
    document.body.appendChild(ggima);
    var lastt = ls.get('tt1woe41gjgjoq');
    if (lastt > 0) {
        jwplayer().seek(lastt)
    }
}

function set_audio_track() {
    var tracks = player.getAudioTracks(track_name);
    console.log(tracks);
    if (tracks.length > 1) {
        for (i = 0; i < tracks.length; i++) {
            if (tracks[i].name == track_name) {
                console.log('!!=' + i);
                player.setCurrentAudioTrack(i)
            }
        }
    }
}
player.on('ready', function() {
    jwplayer().addButton('<svg xmlns="http://www.w3.org/2000/svg" class="jw-svg-icon jw-svg-icon-rewind2" viewBox="0 0 240 240" focusable="false"><path d="m 25.993957,57.778 v 125.3 c 0.03604,2.63589 2.164107,4.76396 4.8,4.8 h 62.7 v -19.3 h -48.2 v -96.4 H 160.99396 v 19.3 c 0,5.3 3.6,7.2 8,4.3 l 41.8,-27.9 c 2.93574,-1.480087 4.13843,-5.04363 2.7,-8 -0.57502,-1.174985 -1.52502,-2.124979 -2.7,-2.7 l -41.8,-27.9 c -4.4,-2.9 -8,-1 -8,4.3 v 19.3 H 30.893957 c -2.689569,0.03972 -4.860275,2.210431 -4.9,4.9 z m 163.422413,73.04577 c -3.72072,-6.30626 -10.38421,-10.29683 -17.7,-10.6 -7.31579,0.30317 -13.97928,4.29374 -17.7,10.6 -8.60009,14.23525 -8.60009,32.06475 0,46.3 3.72072,6.30626 10.38421,10.29683 17.7,10.6 7.31579,-0.30317 13.97928,-4.29374 17.7,-10.6 8.60009,-14.23525 8.60009,-32.06475 0,-46.3 z m -17.7,47.2 c -7.8,0 -14.4,-11 -14.4,-24.1 0,-13.1 6.6,-24.1 14.4,-24.1 7.8,0 14.4,11 14.4,24.1 0,13.1 -6.5,24.1 -14.4,24.1 z m -47.77056,9.72863 v -51 l -4.8,4.8 -6.8,-6.8 13,-12.99999 c 3.02543,-3.03598 8.21053,-0.88605 8.2,3.4 v 62.69999 z"></path></svg>', "Forward 10 sec", function() {
        jwplayer().seek(jwplayer().getPosition() + 10)
    }, "ff11");
    $("div[button=ff11]").detach().insertAfter('.jw-icon-rewind');
    jwplayer().addButton('<svg xmlns="http://www.w3.org/2000/svg" class="jw-svg-icon jw-svg-icon-rewind" viewBox="0 0 240 240" focusable="false"><path d="M113.2,131.078a21.589,21.589,0,0,0-17.7-10.6,21.589,21.589,0,0,0-17.7,10.6,44.769,44.769,0,0,0,0,46.3,21.589,21.589,0,0,0,17.7,10.6,21.589,21.589,0,0,0,17.7-10.6,44.769,44.769,0,0,0,0-46.3Zm-17.7,47.2c-7.8,0-14.4-11-14.4-24.1s6.6-24.1,14.4-24.1,14.4,11,14.4,24.1S103.4,178.278,95.5,178.278Zm-43.4,9.7v-51l-4.8,4.8-6.8-6.8,13-13a4.8,4.8,0,0,1,8.2,3.4v62.7l-9.6-.1Zm162-130.2v125.3a4.867,4.867,0,0,1-4.8,4.8H146.6v-19.3h48.2v-96.4H79.1v19.3c0,5.3-3.6,7.2-8,4.3l-41.8-27.9a6.013,6.013,0,0,1-2.7-8,5.887,5.887,0,0,1,2.7-2.7l41.8-27.9c4.4-2.9,8-1,8,4.3v19.3H209.2A4.974,4.974,0,0,1,214.1,57.778Z"></path></svg>', "Rewind 10 sec", function() {
        var tt = jwplayer().getPosition() - 10;
        if (tt < 0) tt = 0;
        jwplayer().seek(tt)
    }, "ff00");
    $("div[button=ff00]").detach().insertAfter('.jw-icon-rewind');
    $("div.jw-icon-rewind").hide()
});
player.on('error', function(event) {
    var currentFile = player.getPlaylistItem().file;
    var currentTracks = player.getConfig().tracks || [];
    var newFile = null;
    if (currentFile === links.hls4) {
        newFile = links.hls3 || links.hls2
    } else if (currentFile === links.hls3) {
        newFile = links.hls2
    }
    if (newFile) {
        player.load([{
            file: newFile,
            tracks: currentTracks
        }]);
        player.play();
        player.once('firstFrame', function() {
            var lastt = ls.get('tt1woe41gjgjoq');
            if (lastt) {
                player.seek(lastt)
            }
        });
        return true
    }
});
player.on('ready', function() {
    var currentFile = player.getPlaylistItem().file;
    if (links.hls4 && currentFile === links.hls4) {
        fetch(links.hls4, {
            method: 'HEAD'
        }).then(res => {
            if (!res.ok && (links.hls3 || links.hls2)) {
                player.stop();
                player.load([{
                    file: links.hls3 || links.hls2,
                    type: "hls"
                }]);
            }
        }).catch(() => {
            if (links.hls3 || links.hls2) {
                player.stop();
                player.load([{
                    file: links.hls3 || links.hls2,
                    type: "hls"
                }]);
            }
        })
    }
});
player.on("audioTracks", function(event) {
    var tracks = player.getAudioTracks();
    if (tracks.length < 2) return;
    $('.jw-settings-topbar-buttons').mousedown(function() {
        $('#jw-settings-submenu-audioTracks').removeClass('jw-settings-submenu-active');
        $('.jw-submenu-audioTracks').attr('aria-expanded', 'false')
    });
    player.addButton("/images/dualy.svg", "Audio Track", function() {
        $('.jw-controls').toggleClass('jw-settings-open');
        $('.jw-settings-captions, .jw-settings-playbackRates').attr('aria-checked', 'false');
        if ($('.jw-controls').hasClass('jw-settings-open')) {
            $('.jw-submenu-audioTracks').attr('aria-checked', 'true');
            $('.jw-submenu-audioTracks').attr('aria-expanded', 'true');
            $('.jw-settings-submenu-quality').removeClass('jw-settings-submenu-active');
            $('.jw-settings-submenu-audioTracks').addClass('jw-settings-submenu-active')
        } else {
            $('.jw-submenu-audioTracks').attr('aria-checked', 'false');
            $('.jw-submenu-audioTracks').attr('aria-expanded', 'false');
            $('.jw-settings-submenu-audioTracks').removeClass('jw-settings-submenu-active')
        }
    }, "dualSound");
    player.on("audioTrackChanged", function(event) {
        localStorage.setItem('default_audio', event.tracks[event.currentTrack].name)
    });
    if (localStorage.getItem('default_audio')) {
        setTimeout("audio_set(localStorage.getItem('default_audio'));", 300)
    }
});
var current_audio;

function audio_set(audio_name) {
    var tracks = player.getAudioTracks();
    if (tracks.length > 1) {
        for (i = 0; i < tracks.length; i++) {
            if (tracks[i].name == audio_name) {
                if (i == current_audio) {
                    return
                }
                current_audio = i;
                player.setCurrentAudioTrack(i)
            }
        }
    }
}
