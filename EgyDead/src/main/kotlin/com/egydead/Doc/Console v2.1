// (v2.1) HLS2 Direct Link Generator

/**
 * دالة مساعدة لفك تشفير الكود
 */
function deobfuscateCode(p, a, c, k_string) {
  let k = k_string.split('|');
  while (c--) {
    if (k[c]) {
      p = p.replace(new RegExp('\\b' + c.toString(a) + '\\b', 'g'), k[c]);
    }
  }
  return p;
}

/**
 * الدالة الرئيسية التي تبحث عن السكريبت وتولد رابط hls2
 */
function generateHLS2Link() {
  console.log("Searching for obfuscated script...");

  const scriptTag = Array.from(document.querySelectorAll('script')).find(
    s => s.textContent.includes('eval(function(p,a,c,k,e,d)')
  );

  if (!scriptTag) {
    console.error("Could not find the obfuscated script on this page. ❌");
    return;
  }

  const evalRegex = /eval\(function\(p,a,c,k,e,d\)\{.*?\}\(\'(.*?)\',(\d+),(\d+),\'(.*?)\'\.split\(\'\|\'\)\)\)/;
  const matches = scriptTag.textContent.match(evalRegex);

  if (!matches || matches.length < 5) {
    console.error("Could not extract parts from the script. ❌");
    return;
  }

  const [packedString, base, count, keyString] = [matches[1], parseInt(matches[2]), parseInt(matches[3]), matches[4]];

  const deobfuscatedJs = deobfuscateCode(packedString, base, count, keyString);

  // *** التحديث الرئيسي هنا ***
  // تعبير نمطي جديد للبحث عن المفتاح "hls2" واستخراج الرابط الخاص به
  const hls2Regex = /"hls2"\s*:\s*"([^"]+)"/;
  const urlMatch = deobfuscatedJs.match(hls2Regex);

  if (urlMatch && urlMatch[1]) {
    const finalUrl = urlMatch[1];
    console.log("%cHLS2 link generated successfully! ✅", "color: #22a36a; font-size: 16px; font-weight: bold;");
    console.log("Clickable Link:", finalUrl);
    console.log("Link for Copying:", finalUrl);
  } else {
    console.error("Deobfuscation was successful, but the 'hls2' key was not found. ❌");
  }
}

// تشغيل الدالة الرئيسية
generateHLS2Link();

